<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>{{ source_info.title }} — Demo Snapshot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body { font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; margin: 24px; color: #111; }
    header { border-bottom: 1px solid #eee; padding-bottom: 12px; margin-bottom: 18px; }
    h1 { font-size: 20px; margin: 0 0 6px 0; }
    .muted { color: #666; font-size: 13px; }
    .summary { display:flex; gap: 18px; margin-top: 12px; }
    .card { background: #fafafa; padding: 12px; border-radius: 8px; border: 1px solid #eee; min-width: 160px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #eee; padding: 8px; text-align: left; vertical-align: top; }
    th { background: #f5f5f5; font-weight: 600; }
    .badge { display:inline-block; padding: 4px 8px; border-radius: 999px; background: #eee; font-size: 12px; }
    .fail { color: #b00020; font-weight: 700; }
    .pass { color: #0b6f24; font-weight: 700; }
    footer { margin-top: 26px; border-top: 1px solid #eee; padding-top: 12px; color: #666; font-size: 13px; }
    .climax { margin-top: 18px; padding: 14px; border-radius: 8px; background: linear-gradient(90deg,#fff7f7,#fff); border:1px solid #f5d0d0; }
  </style>
</head>
<body>
  <header>
    <h1>{{ source_info.title }}</h1>
    <div class="muted">Generated: {{ generated_at }}</div>
    <div class="summary">
      <div class="card">
        <div>Total evidence records</div>
        <div style="font-size:18px; font-weight:700;">{{ summary.total_records }}</div>
      </div>
      <div class="card">
        <div>Frameworks</div>
        <div style="font-size:18px; font-weight:700;">
          {% for fw, count in summary.by_framework.items() %}
            <span class="badge">{{ fw }}: {{ count }}</span>
          {% endfor %}
        </div>
      </div>
      <div class="card">
        <div>Customers</div>
        <div style="font-size:18px; font-weight:700;">{{ summary.by_customer | length }}</div>
      </div>
    </div>
  </header>

  <section>
    <h2>Demo Climax — Compliance Snapshot</h2>
    <div class="climax">
      <p>
        This demo snapshot presents a concise compliance posture pulled from the seeded evidence.
        Focus items are "recent failures" and representative evidence samples below. Use this
        as the climactic screen in your demo to show authoritative technical evidence for SOC2/HIPAA/FedRAMP controls.
      </p>
      <ul>
        <li><strong>Top frameworks present:</strong> {% for fw in summary.by_framework.keys() %} {{ fw }} {% endfor %}</li>
        <li><strong>Total evidence:</strong> {{ summary.total_records }}</li>
        <li><strong>Recent failures:</strong> {{ summary.recent_failures | length }} shown below</li>
      </ul>
    </div>
  </section>

  <section>
    <h3>Recent Failures</h3>
    {% if summary.recent_failures %}
      <table>
        <thead>
          <tr><th>Customer</th><th>Framework</th><th>Control</th><th>Source</th><th>Last Collected</th><th>Artifact</th><th>Status</th></tr>
        </thead>
        <tbody>
        {% for r in summary.recent_failures %}
          <tr>
            <td>{{ r.customer_id or "(unknown)" }}</td>
            <td>{{ r.framework or "(n/a)" }}</td>
            <td>{{ r.control_id or "(n/a)" }}</td>
            <td>{{ r.source_system or "(n/a)" }}</td>
            <td>{{ r.last_collected or "(n/a)" }}</td>
            <td>{{ r.artifact_ref or "(n/a)" }}</td>
            <td class="fail">{{ r.status }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No recent failures detected in the snapshot.</p>
    {% endif %}
  </section>

  <section>
    <h3>Representative Evidence Samples</h3>
    <table>
      <thead><tr><th>Customer</th><th>Framework</th><th>Control</th><th>Source</th><th>Artifact</th><th>Last Collected</th><th>Status</th></tr></thead>
      <tbody>
      {% for r in rows[:50] %}
        <tr>
          <td>{{ r.customer_id or "(unknown)" }}</td>
          <td>{{ r.framework or "(n/a)" }}</td>
          <td>{{ r.control_id or "(n/a)" }}</td>
          <td>{{ r.source_system or "(n/a)" }}</td>
          <td>{{ r.artifact_ref or "(n/a)" }}</td>
          <td>{{ r.last_collected or "(n/a)" }}</td>
          <td class="{{ r.status|lower }}">{{ r.status }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </section>

  <footer>
    <div class="muted">This snapshot was generated from seeded demo data. Ensure PII/sensitive artifacts are anonymized before sharing publicly.</div>
  </footer>
</body>
</html>
